# PostgreSQL模块解析

​	PostgreSQL模块下主要有初始化、SQL引擎、存储模块、事务模块、日志模块组成。由于初始化在开发过程中一般不会更改，所以初始化模块过程本文不会提及，读者可自行查阅。

## 一、SQL引擎

​	SQL引擎是数据库的核心组件，包括查询编译和查询执行，查询编译包括查询分析、查询重写、查询优化，如下图所示。

![](./img/SQLEngineProcess.png)

​	显然，一套查询流程中每个模块只需要负责接收前一个模块的结果和计算下一个模块所需的结果，这样就保证了我们在对其中一个或几个模块时对其它模块透明。

​	在接下来讨论之前，有几个名词需要定义一下：

- command type：产生查询树打命令，如SELECT、INSERT、DELETE、UPDATE等。
- range table：查询用到的所有表。
- result relation：查询结果所返回的表，用range table内的序号来指向结果表。SELECT语句没有结果表。
- target list：表示查询目标的序列。
- qualification：限定查询结果的表达式。
- join tree：表的组织形式。这是将表组织起来，产生最终要访问表的形式，通常为树状形式，如果对于无join连接的语句如SELECT ... FROM a, b，产生的join tree为a，b这个list。

#### 查询分析

​	查询分析主要做的是将SQL命令转换为Query结构的查询树。这部分主要是编译原理的内容，就不再详述。

#### 查询重写

​	rewrite system是PostgreSQL根据已有的规则来对一颗查询树进行重写，最终输出的也是查询树。这些规则存储在pg_rewrite系统表中。

​	视图

#### 生成路径/生成计划

​	这一模块将一个Query结构的查询树转换成执行路径较优（耗时、索引方式）的执行路径。

























